CREATE DATABASE shortterm WITH DURATION 7d
CREATE USER admin WITH PASSWORD 'admin' WITH ALL PRIVILEGES
CREATE DATABASE longterm WITH DURATION 156w
CREATE CONTINUOUS QUERY aggregate_load ON longterm BEGIN SELECT mean(temperature) AS temperature, mean(humidity) AS humidity, mean(batteryvoltage) AS batteryvoltage, mean(batterylevel) AS batterylevel INTO longterm.autogen.ukmqtt FROM shortterm.autogen.ukmqtt GROUP BY time(15m),* END
CREATE CONTINUOUS QUERY aggregate_load_2 ON longterm BEGIN SELECT mean(batteryactualdcpower) AS batteryactualdcpower, last(batterynominalpower) AS batterynominalpower, last(batterynominalcapacity) AS batterynominalcapacity, mean(batteryactualdcvoltage) AS batteryactualdcvoltage, last(actualbatterystateofcharge) AS actualbatterystateofcharge INTO longterm.autogen.eosbattery FROM shortterm.autogen.eosbattery GROUP BY time(15m),* END
CREATE CONTINUOUS QUERY aggregate_load_3 ON longterm BEGIN SELECT last(pvinstalledcapacity) AS pvinstalledcapacity, mean(pvactualdcvoltage) AS pvactualdcvoltage, mean(invertertotaldcpower) AS invertertotaldcpower, last(inverteraccumulatedactiveenergyproduction) AS inverteraccumulatedactiveenergyproduction, mean(inverteractualfrequency) AS inverteractualfrequency, mean(pvactualdccurrent) AS pvactualdccurrent, mean(inverteractualreactivepower) AS inverteractualreactivepower, mean(inverteractualactivepower) AS inverteractualactivepower, mean(pvactualdcpower) AS pvactualdcpower INTO longterm.autogen.eosinverter FROM shortterm.autogen.eosinverter GROUP BY time(15m),* END
CREATE CONTINUOUS QUERY aggregate_load_4 ON longterm BEGIN SELECT mean(InverterPVActualActivePower) AS InverterPVActualActivePower, last(InverterAccumulatedActiveEnergyProduction) AS InverterAccumulatedActiveEnergyProduction, mean(InverterPVActualReactivePower) AS InverterPVActualReactivePower, mean(InverterGridActivePowerLoad) AS InverterGridActivePowerLoad, mean(InverterConsumerActivePowerLoad) AS InverterConsumerActivePowerLoad, last(PvInstalledCapacity) AS PvInstalledCapacity INTO longterm.autogen.froniusinverter FROM shortterm.autogen.froniusinverter GROUP BY time(15m),* END
